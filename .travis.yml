stages:
  - name: test
  - name: deploy
    if: branch = master

jobs:
  include:
    - stage: deploy
      language: csharp
      mono: none
      dotnet: 2.1
      name: GitHub
      env: 
        - PLATFORM=linux-x64
        - VERSION=$(cat .version)
      script:
        - dotnet publish ./src/App -r $PLATFORM /property:Version=$VERSION -o ../../dist/oas-$VERSION-$PLATFORM
        - mkdir ./dist/zip
        - cd ./dist
        - tar -zcvf ./oas-$VERSION-$PLATFORM -C ./zip
        - zip -r ./zip/oas-$VERSION-$PLATFORM.zip ./oas-$VERSION-$PLATFORM
      deploy:
        provider: releases
        api_key: $GITHUB_OAUTH_TOKEN
        name: $VERSION
        file_glob: true
        file: ./dist/zip/*
        skip_cleanup: true
