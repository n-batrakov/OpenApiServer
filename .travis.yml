stages:
  - name: test
  - name: deploy
    if: branch = master

jobs:
  include:
    - stage: deploy
      language: csharp
      mono: none
      dotnet: 2.1
      name: GitHub
      env: [PLATFORM=linux-x64]
      script:
        - dotnet publish ./src/App -r linux-x64 /property:Version=$(cat .version) -o ../../dist/linux-x64
        - zip -r linux-x64.zip ./dist/linux-x64
        - ls
        - ls dist
      deploy:
        provider: releases
        api_key: $GITHUB_OAUTH_TOKEN
        name: oas-$(cat .version)
        file: ./dist/linux-x64.zip
        skip_cleanup: true
